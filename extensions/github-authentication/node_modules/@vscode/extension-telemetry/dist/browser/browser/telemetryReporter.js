/*---------------------------------------------------------
 * Copyright (C) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------*/
import * as vscode from "vscode";
import { oneDataSystemClientFactory } from "../common/1dsClientFactory";
import { BaseTelemetrySender } from "../common/baseTelemetrySender";
import { BaseTelemetryReporter } from "../common/baseTelemetryReporter";
import { TelemetryUtil } from "../common/util";
import { appInsightsClientFactory } from "../common/appInsightsClientFactory";
function getBrowserRelease(navigator) {
    if (navigator.userAgentData) {
        const browser = navigator.userAgentData.brands[navigator.userAgentData.brands.length - 1];
        return `${navigator.userAgentData.platform} - ${browser?.brand} v${browser?.version}}`;
    }
    else {
        return navigator.appVersion;
    }
}
export default class TelemetryReporter extends BaseTelemetryReporter {
    constructor(key, replacementOptions) {
        let clientFactory = (key) => appInsightsClientFactory(key, undefined, replacementOptions);
        // If key is usable by 1DS use the 1DS SDk
        if (TelemetryUtil.shouldUseOneDataSystemSDK(key)) {
            clientFactory = (key) => oneDataSystemClientFactory(key, vscode);
        }
        const osShim = {
            release: getBrowserRelease(navigator),
            platform: "web",
            architecture: "web",
        };
        const sender = new BaseTelemetrySender(key, clientFactory);
        // AIF is no longer supported
        if (key && (key.indexOf("AIF") === 0)) {
            throw new Error("AIF keys are no longer supported. Please switch to 1DS keys for 1st party extensions");
        }
        super(sender, vscode, { additionalCommonProperties: TelemetryUtil.getAdditionalCommonProperties(osShim) });
    }
}
//# sourceMappingURL=telemetryReporter.js.map